---
import { cvData } from '../data/cv-data';
import { getLangFromUrl, useTranslations, resolve } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const initials = cvData.personal.name.split(' ').map(n => n[0]).join('');
const greeting = resolve(cvData.hero.greeting, lang);
const tagline = resolve(cvData.hero.tagline, lang);
const title = resolve(cvData.personal.title, lang);
const subtitle = cvData.personal.subtitle ? resolve(cvData.personal.subtitle, lang) : undefined;
---
<section id="hero" class="relative min-h-[85vh] flex items-center pt-32 pb-24 px-6 overflow-hidden" data-hero-section>
  <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
    <div class="absolute top-20 -left-40 w-96 h-96 rounded-full opacity-20 blur-3xl blob-animate" style="background: var(--accent);"></div>
    <div class="absolute bottom-0 -right-40 w-96 h-96 rounded-full opacity-15 blur-3xl blob-animate-reverse" style="background: var(--accent-secondary);"></div>
  </div>

  <div class="relative mx-auto max-w-4xl text-center">
    <div class="flex justify-center mb-8" data-hero-avatar>
      <div class="relative">
        {cvData.personal.photo ? (
          <div class="w-28 h-28 md:w-32 md:h-32 rounded-full p-[3px]" style="background: linear-gradient(135deg, var(--accent), var(--accent-secondary));">
            <img src={cvData.personal.photo} alt={cvData.personal.name}
                 width={128} height={128}
                 class="w-full h-full rounded-full object-cover" loading="eager" />
          </div>
        ) : (
          <div class="w-28 h-28 md:w-32 md:h-32 rounded-full p-[3px]" style="background: linear-gradient(135deg, var(--accent), var(--accent-secondary));">
            <div class="w-full h-full rounded-full flex items-center justify-center" style="background: var(--bg-alt);">
              <span class="text-3xl font-bold" style="color: var(--accent);">{initials}</span>
            </div>
          </div>
        )}
        <div class="absolute -bottom-1 -right-1 w-5 h-5 rounded-full border-[3px] pulse-dot" style="background: #22c55e; border-color: var(--bg);"></div>
      </div>
    </div>

    <p class="text-sm font-semibold tracking-wider uppercase mb-4" style="color: var(--accent);" data-hero-greeting>{greeting}</p>

    <h1 class="mb-4" data-hero-headline style="letter-spacing: -0.025em; font-kerning: none;">
      <span class="font-bold gradient-text-animated block" style="font-size: var(--hero-name); line-height: var(--hero-leading);">{cvData.personal.name}</span>
      <span class="font-medium block mt-4" style="font-size: var(--hero-title); color: var(--text);" data-hero-title>{title}</span>
    </h1>
    {subtitle && <p class="text-base mb-2" style="color: var(--text-muted);">{subtitle}</p>}

    <p class="text-base max-w-xl mx-auto leading-relaxed mb-10" style="color: var(--text-muted);" data-hero-tagline>{tagline}</p>

    <div class="flex flex-wrap gap-3 justify-center mb-12" data-hero-cta>
      <a href="mailto:contact" class="obf-email btn-primary inline-flex items-center gap-2 text-sm px-6 py-3 rounded-xl font-medium text-white" style={`background: linear-gradient(135deg, var(--accent), var(--accent-secondary));`} aria-label={t('a11y.sendEmail')}>
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
        <span>{t('hero.email')}</span>
      </a>
      <a href="tel:0" class="obf-phone btn-outline inline-flex items-center gap-2 text-sm px-6 py-3 rounded-xl font-medium border" style={`border-color: var(--border); color: var(--text);`} aria-label={t('a11y.call')}>
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
        <span>{t('hero.phone')}</span>
      </a>
      <button
        id="print-btn"
        class="print-hide btn-outline inline-flex items-center gap-2 text-sm px-6 py-3 rounded-xl font-medium border min-h-[44px]"
        style={`border-color: var(--border); color: var(--text);`}
        aria-label={t('a11y.downloadCv')}
      >
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        {t('hero.downloadPdf')}
      </button>
    </div>

    {cvData.hero.stats && cvData.hero.stats.length > 0 && (
    <div class="flex flex-wrap gap-x-8 gap-y-4 justify-center" data-hero-stats>
      {cvData.hero.stats.map((stat, i) => (
        <>
          {i > 0 && <div class="w-px" style="background: var(--border);" aria-hidden="true"></div>}
          <div class="text-center">
            <p class="text-2xl md:text-3xl font-bold" style="color: var(--text);">{stat.value}</p>
            <p class="text-xs mt-0.5" style="color: var(--text-muted);">{resolve(stat.label, lang)}</p>
          </div>
        </>
      ))}
    </div>
    )}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const printBtn = document.getElementById('print-btn');
    if (printBtn) {
      printBtn.addEventListener('click', () => window.print());
    }
  });
</script>
